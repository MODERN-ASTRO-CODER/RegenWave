<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>RegenWave — App</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div id="regenwave-bg">
        <div class="blob a"></div>
        <div class="blob b"></div>
    </div>
    <div id="regenwave-gradient"></div>

    <header class="header">
        <div>
            <div class="title">RegenWave — Neural Regeneration AI</div>
            <div class="subtitle">AI-assisted decision system for spinal and axonal injury treatment</div>
        </div>
        <div class="small">Built by <strong>HRISHAB SHUKLA</strong></div>
    </header>

    <main>
        <section class="card" style="margin:20px;">
            <div class="app-header">
                <div>
                    <h3>Upload Image</h3>
                    <div class="input-row">
                        <input type="file" id="fileInput" accept="image/*">
                        <button id="analyzeBtn" class="btn primary">Analyze</button>
                    </div>
                    <p class="small">Filename must match dataset entries to show analysis.</p>
                </div>
                <!doctype html>
                <html lang="en">

                <head>
                    <meta charset="utf-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1">
                    <title>RegenWave — App</title>
                    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
                    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap"
                        rel="stylesheet">
                    <meta name="description"
                        content="RegenWave demo — upload an image to get treatment recommendations and charts.">
                    <link rel="stylesheet" href="styles.css">
                    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
                </head>

                <body>
                    <div class="site-root">
                        <div id="regenwave-bg" aria-hidden>
                            <div class="blob a"></div>
                            <div class="blob b"></div>
                        </div>

                        <header class="app-header">
                            <div class="app-brand">
                                <div class="brand">RegenWave</div>
                                <div class="subtitle">Neural regeneration decision prototype</div>
                            </div>
                            <div class="built">Built by <strong>HRISHAB SHUKLA</strong></div>
                        </header>

                        <main class="app-main">
                            <section class="card panel upload-panel">
                                <h3>Upload Image</h3>
                                <p class="small">Select a microscopy image file. The demo uses filenames to match sample
                                    metadata.</p>
                                <div class="input-row">
                                    <input type="file" id="fileInput" accept="image/*">
                                    <button id="analyzeBtn" class="btn primary">Analyze</button>
                                </div>
                                <div id="status" class="small muted"></div>
                            </section>

                            <section class="card panel results-panel" id="resultArea">
                                <h3>Results</h3>
                                <div class="empty">No analysis yet — upload a file and click Analyze.</div>
                            </section>
                        </main>

                        <footer class="site-footer">Static demo — host the <code>static_site</code> folder to share
                            publicly.</footer>
                    </div>

                    <script>
                        // Sample metadata (embedded) — kept small for the static demo
                        const METADATA = [
                            { "filename": "nerve_001.png", "label": "regeneration", "chemical": "BDNF", "dose": 0.2, "penetration": 2, "days_until_next": 5, "counter_chemicals": "Nogo-A,MAG,OMgp", "nerve_state": "damaged" },
                            { "filename": "nerve_002.png", "label": "observe", "chemical": "NGF", "dose": 0.0, "penetration": 0, "days_until_next": 0, "counter_chemicals": "Nogo-A,CSPGs", "nerve_state": "healthy" },
                            { "filename": "nerve_003.png", "label": "bypass", "chemical": "GDNF", "dose": 0.4, "penetration": 3, "days_until_next": 3, "counter_chemicals": "Nogo-A,MAG", "nerve_state": "severely_damaged" }
                        ];

                        (function () {
                            const fileInput = document.getElementById('fileInput');
                            const analyzeBtn = document.getElementById('analyzeBtn');
                            const status = document.getElementById('status');
                            const resultArea = document.getElementById('resultArea');

                            function findMeta(filename) {
                                return METADATA.find(m => m.filename === filename);
                            }

                            function renderResult(meta, imgDataUrl) {
                                const days = Array.from({ length: 15 }, (_, i) => i);
                                const regen = days.map(d => Math.min(1.0, meta.dose * d * 0.85));
                                const inhib = days.map(d => Math.max(0, 1.0 - d * 0.07));

                                resultArea.innerHTML = `
                                    <div class="result-container">
                                        <div class="left card">
                                            <h4>Uploaded Image</h4>
                                            <img src="${imgDataUrl}" alt="uploaded image">
                                            <h4>Case Summary</h4>
                                            <ul>
                                                <li><strong>Predicted Nerve State:</strong> ${meta.nerve_state}</li>
                                                <li><strong>Recommended Action:</strong> ${meta.label}</li>
                                                <li><strong>Primary Chemical:</strong> ${meta.chemical}</li>
                                                <li><strong>Next Dose (days):</strong> ${meta.days_until_next}</li>
                                            </ul>
                                        </div>
                                        <div class="right card">
                                            <h4>Regeneration vs Inhibitory Signals</h4>
                                            <div style="height:260px"><canvas id="chartCanvas"></canvas></div>
                                            <h4>Treatment Recommendation</h4>
                                            <p><strong>Chemical:</strong> ${meta.chemical}</p>
                                            <p><strong>Dose Level:</strong> ${meta.dose}</p>
                                            <p><strong>Penetration:</strong> ${meta.penetration} mm</p>
                                            ${meta.counter_chemicals ? `<p class="warn">Counter-regeneration molecules: ${meta.counter_chemicals}</p>` : ''}
                                            <div class="verdict">This recommendation balances pro-regeneration signaling with known inhibitors.</div>
                                            <div class="muted" style="margin-top:12px"><a href="app.html" class="btn ghost">Analyze another</a></div>
                                        </div>
                                    </div>
                                `;

                                const ctx = document.getElementById('chartCanvas').getContext('2d');
                                new Chart(ctx, {
                                    type: 'line',
                                    data: {
                                        labels: days,
                                        datasets: [
                                            { label: `${meta.chemical} (Regeneration)`, data: regen, borderColor: '#3CC5FF', borderWidth: 3, fill: false },
                                            { label: 'Inhibitory Molecules', data: inhib, borderColor: '#C87DFF', borderWidth: 3, fill: false }
                                        ]
                                    },
                                    options: { responsive: true, maintainAspectRatio: false }
                                });
                            }

                            analyzeBtn.addEventListener('click', () => {
                                const f = fileInput.files[0];
                                status.textContent = '';
                                if (!f) { status.textContent = 'Please choose a file.'; return; }
                                const meta = findMeta(f.name);
                                if (!meta) { status.textContent = 'Filename not found in demo dataset.'; return; }
                                status.textContent = `Found metadata for ${f.name}`;
                                const reader = new FileReader();
                                reader.onload = (e) => renderResult(meta, e.target.result);
                                reader.readAsDataURL(f);
                            });
                        })();
                    </script>

                </body>

                </html>